# Control Flow Parsing Implementation Plan (Phase 2.4)

## Goal
Implement control flow statement parsing: if/elif/else, while, and for loops.

## Python Control Flow Syntax (What we need to support)

### If statements:
```python
if condition:
    statement

if condition:
    statement
else:
    statement

if condition:
    statement
elif condition2:
    statement
else:
    statement
```

### While loops:
```python
while condition:
    statement

while condition:
    statement
else:
    statement  # executes if loop completes normally (no break)
```

### For loops:
```python
for item in iterable:
    statement

for item in iterable:
    statement
else:
    statement  # executes if loop completes normally (no break)
```

## Implementation Strategy

We'll implement these in order of complexity:
1. **If statements** (simplest) - single if, if-else, if-elif-else chains
2. **While loops** - basic while, while-else
3. **For loops** - basic for, for-else

## Phase 1: If Statements

### Step 1: Check AST (Already exists!)
- [x] If statement AST node already defined in ast.rs
- [x] Structure: condition, then_block, elif_blocks, else_block

### Step 2: Parser Implementation for If
- [ ] Implement `parse_if()` method
- [ ] Parse "if" keyword and condition
- [ ] Parse colon
- [ ] Parse indented block (INDENT...DEDENT)
- [ ] Parse elif chains (zero or more)
- [ ] Parse optional else block
- [ ] Handle nested if statements

### Step 3: Testing - If Statements
- [ ] Test: Simple if
- [ ] Test: if-else
- [ ] Test: if-elif-else
- [ ] Test: Multiple elif
- [ ] Test: Nested if
- [ ] Test: If with multiple statements in blocks
- [ ] Error tests: Missing colon, missing block, etc.

## Phase 2: While Loops

### Step 1: Check AST (Already exists!)
- [x] While statement AST node already defined in ast.rs
- [x] Structure: condition, body, else_block

### Step 2: Parser Implementation for While
- [ ] Implement `parse_while()` method
- [ ] Parse "while" keyword and condition
- [ ] Parse colon
- [ ] Parse indented body block
- [ ] Parse optional else block
- [ ] Handle nested while loops

### Step 3: Testing - While Loops
- [ ] Test: Simple while
- [ ] Test: while-else
- [ ] Test: Nested while
- [ ] Test: While with break/continue
- [ ] Test: While with multiple statements
- [ ] Error tests: Missing colon, missing block, etc.

## Phase 3: For Loops

### Step 1: Check AST (Already exists!)
- [x] For statement AST node already defined in ast.rs
- [x] Structure: target, iter, body, else_block

### Step 2: Parser Implementation for For
- [ ] Implement `parse_for()` method
- [ ] Parse "for" keyword
- [ ] Parse target (identifier or tuple unpacking)
- [ ] Parse "in" keyword
- [ ] Parse iterable expression
- [ ] Parse colon
- [ ] Parse indented body block
- [ ] Parse optional else block
- [ ] Handle nested for loops

### Step 3: Testing - For Loops
- [ ] Test: Simple for
- [ ] Test: for-else
- [ ] Test: For with tuple unpacking
- [ ] Test: Nested for
- [ ] Test: For with break/continue
- [ ] Test: For with multiple statements
- [ ] Error tests: Missing colon, missing in, etc.

## Critical Requirements

### Indentation Handling
- Must properly handle INDENT/DEDENT tokens for blocks
- Each block must be properly indented
- Must handle nested indentation correctly

### Error Handling
- Missing colons after if/while/for
- Missing conditions
- Missing blocks
- Improper indentation
- Invalid target expressions in for loops

## Documentation
- [ ] Update CHANGELOG.md
- [ ] Update ROADMAP.md

## Notes
- The AST nodes already exist (If, While, For)
- Focus on parser implementation and indentation handling
- Test thoroughly with nested structures
- Ensure proper error messages for common mistakes
